<!DOCTYPE html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>B-GUARD HUB</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="css/pico-bootstrap-grid.css">
	<link rel="stylesheet" href="css/bgs1.css">
	<link rel="shortcut icon" href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAADJElEQVR4nO2ZzU4UQRDH96gc5KAeVhd3q1kIFxN9FBU8qE9giFxMPC4awaVqNsaLV40+AqhHTmo06smPRDDKslVIYpCTSmDF1OwCy37NzvTM4GEqqTBhunr+v+7q7oJOpRJLLFxLF7gPiG8B8SKQbLg/kW9mSuXD/72GdIH7DPJLQ7Ld7EDyIg6ItI0GpW4XuNcBT0YNADYadKq6BqMsxACwGFiD5ptH8J/oASS4Bk96ks/RA3BwDbrSuwUblELkAGihQVe4rvQOU/c8jl0oY6uh1gFP6mJx92CUBaWO8xzIHJSGHEnWEN8A4meGhA3J77ozID/Vd6bIp1JxmNGP1d2r7aBTGTDEjw3yVtf8dXOYtwzyI41JhaihTfDeR7u1y9HKRUO87im8dTH+BFwZC0ND4GBDfM0g//Utfte5CsTjBwKgo2cnvgEC5UKsAAMzSycMyZq9eNmBWG+3JkID8ONA8tY4PGFK30+b4lq/6/rs8ASgvAvabyrsmqRFOPIqOHzZs1+UK9rWX9/ivwYzKFO9Q/DHfHE502vf7raL8qnHGd0wxLd9A3QG47mm0VnIT8nxfW1IztfbMaBUDPGsQT7X2EZjoKVw49lU1AYo5aaP0q7w4lp//cStAvI8kNx1HXlef6dQ+Xs/juyBcqlpxJciB6iXBg1TzItmZnlIXRcwEL/PYuVMc1zeqZzVd4DyRtsOlsp5QP6yDwDlV+wAzek0Ml052il22OFjbmHWKecxBoDWFGqfTtnC10O6KxnkS/rcJW22402hpkXcKZ0M8usGsFfgVIbzuDrYkjYU0SI2KNN+z4L96cDfVLSW2ID8IWg/oBpQpnwDWImvjeb9Xv9VYiI5yKzE1/I56/BI9s5KzmYGTN2tAOIo5vJtTvLIANSAZNQ9nOzFV/XkDqLBCqAGweN2EFwFkqs2GqwAahAyqn8eBgDQFGw78qEAAEpxx73aav4C8kMg3vTcUYg3gfjBUKl8MkwNoZiC5FCuA/ETIFnW0kC99sxz+s5P2R3IkgsOS0snFxzU9UhPLji8DJILDuqyjycXHN6WSS44Ekss5cf+AWDAXZProNXzAAAAAElFTkSuQmCC" />
	<script src="js/jquery.min.js"></script>
	<script src="js/modal.js"></script>
	<script src="js/bgh1.js"></script>

</head>
<body>
    <main class="container">
		<div>
			<img src="i/logo-64.png" style="float:right">
			<p id="datetime" style="float:right; padding-top: 10px; padding-right: 20px; font-size: 1.75em"></p>
			<p style="padding-top: 15px; font-size: 1.5em">B-GUARD Hub</p>
		</div>
		<details open="">
			<summary role="button">Monitor</summary>
			<div id="monitor_dev">
			</div>
		</details>
		<details>
			<summary role="button">Devices</summary>
			<div id="conf_dev">loading...</div>
			<div class="row">
				<label class="col-2">
					<input type="checkbox" id="selpairing" role="switch" onclick="pairingActive(this)">Pairing active
				</label>
			</div>
		</details>

		<details>
			<summary role="button">Configuration</summary>
			<form action="/doconfig" id="formwifi" role="form">
				<article>
					<header>Radio</header>
					<div class="row">
						<label for="cnfcode" class="col-1">
							UID
							<input type="number" id="cnfcode" name="cnfcode" min="0" max="9" value="%CNFCODE%">
						</label>
						<label for="cnffreq" class="col-2">
							Radio Freq. %LORAOK%
							<input type="number" id="cnffreq" name="cnffreq" min="135" max="525" value="%CNFFREQ%">
						</label>
						<label for="cnfdist" class="col-1">
							Range
							<input type="number" id="cnfdist" name="cnfdist" min="0" max="3" value="%CNFDIST%">
						</label>
					</div>
				</article>
				<article>
					<header>Wifi</header>
					<div class="grid">
						<label for="ssid">
							SSID
							<input type="text" id="wifissid" name="wifissid" placeholder="Wifi SSID" value="%WIFISSID%">
						</label>
						<label for="password">
							Password
							<input type="text" id="wifipass" name="wifipass" placeholder="Wifi password" value="%WIFIPASS%">
						</label>
					</div>
				</article>
				<article>
					<header>Mqtt</header>
					<div class="grid">
						<label for="mqtthost">
							Host
							<input type="text" id="mqtthost" name="mqtthost" placeholder="Mqtt host" value="%MQTTHOST%">
						</label>
						<label for="mqttuser">
							User
							<input type="text" id="mqttuser" name="mqttuser" placeholder="Mqtt user" value="%MQTTUSER%">
						</label>
						<label for="mqttuser">
							Password
							<input type="text" id="mqttpass" name="mqttpass" placeholder="Mqtt pass" value="%MQTTPASS%">
						</label>
					</div>
				</article>
				<article>
					<header>NTP <small>(Updated once an hour)</small></header>
					<div class="grid">
						<label for="tz">
							Time zone <a href="https://github.com/nayarsystems/posix_tz_db/blob/master/zones.csv"  target="_blank" style="font-size: 80%">(list here)</a>
							<input type="text" id="tz" name="tz" placeholder="TZ" value="%TZ%">
						</label>
						<label for="ntp">
							NTP server <a href="https://www.ntppool.org" target="_blank" style="font-size: 80%">(list on NTP project)</a>
							<input type="text" id="ntp" name="ntp" placeholder="NTP address" value="%NTP%">
						</label>
					</div>
				</article>
				<ins style="position:absolute;opacity:0" id="resultwifi"><strong>Done!</strong></ins>
				<button type="submit" class="secondary">Save</button>
			</form>
		</details>

		<details>
			<summary role="button">Tools</summary>
			<form method='post' action='/doupdate' enctype='multipart/form-data'>
				<article>
					<header>Update module firmware %VERSION%</header>
					<a style="float:right" href="https://github.com/PM04290/LoRa2HA/tree/main/HUBs" target="blank">GitHub</a>
					<label for="formBinSm" class="form-label">Select .bin file to upload</label>
					<input type="file" accept=".bin" id="formBinSm" name='update'>
					<footer>
						<ins style="position:absolute;opacity:0" id="resultfirmware"><strong>Enregistr&eacute;!</strong></ins>
						<button type="submit" class="secondary">Update</button>
					</footer>
				</article>
			</form>
			<form method='post' action='/dofile' enctype='multipart/form-data'>
				<article>
					<header>Send file</header>
					<label for="formFileSm" class="form-label">Select file to send (config, module firmware, ...) max file name len : 25</label>
					<input type="file" accept=".json, .html, .js, .css, .png, .hex, .modl" class="form-control form-control-sm" id="formFileSm" name='update'>
					<footer>
						<ins style="position:absolute;opacity:0" id="resultfile"><strong>Enregistr&eacute;!</strong></ins>
						<button type="submit" class="secondary">Send</button>
					</footer>
				</article>
			</form>
			<div class="grid">
				<a href="/config.json" role="button" class="contrast" style="margin-bottom:2px" download>Download configuration file</a>
				<div role="button" class="secondary outline">
					<label for="log" data-tooltip="Display LoRa packet in console">
						<input type="checkbox" id="logpacket" name="logpacket" role="switch" onclick="logpacket(this)">Log LoRa packet
					</label>
				</div>
				<a href="/restart" role="button" class="contrast" style="margin-bottom:2px">Reset</a>
			</div>
		</details>
		<!-- Modal -->
		<dialog id="modalplot">
			<article style="width:60%; height:40%">
				<canvas id="plot" class="chart"></canvas>
			</article>
		</dialog>
		<!-- -->
		<datalist id="classlistBS"></datalist>
		<datalist id="classlistNS"></datalist>
		<datalist id="unitlist"></datalist>
	</main>
	<div id="toast" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: rgba(0, 0, 0, 0.7); color: white; padding: 1rem 2rem; border-radius: 8px; text-align: center; z-index: 1000;">Done !</div>
	<div id="floatinfo" class="outline" style="position: fixed; top: 0px; width: 100%; height: 2em; opacity:0; text-align: center; z-index: 99; background-color: darkorange; align-content: center;">
		<h4>Pairing is active</h4>
	</div>
	<script>
	window.addEventListener('load', onLoad);
	</script>
</body>																																	